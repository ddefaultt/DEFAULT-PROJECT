<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¯Ø®ÙˆÙ„</title>
</head>
<body>

<h1>ğŸ” ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ</h1>
<div id="code" style="font-size:30px;font-weight:bold;margin-bottom:10px;"></div>
<p>ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ TEAM X NINJA Ù„ØªÙØ¹ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯.</p>

<script>
// ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ø®Ø§Øµ Ø¨Ù€ IP ÙˆØ§Ù„ØªØ­Ù‚Ù‚ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹
async function loadCode() {
  // 1ï¸âƒ£ Ø¬Ù„Ø¨ Ø§Ù„ÙƒÙˆØ¯ Ù…Ù† Netlify Function
  const res = await fetch("/.netlify/functions/checkCode?action=get");
  const data = await res.json();
  const codeDiv = document.getElementById("code");
  codeDiv.innerText = data.code;

  // ØªØ®Ø²ÙŠÙ† Ø§Ù„ÙƒÙˆØ¯ ÙÙŠ LocalStorage
  localStorage.setItem("my_code", data.code);

  // 2ï¸âƒ£ Ø§Ù„ØªØ­Ù‚Ù‚ ØªÙ„Ù‚Ø§Ø¦ÙŠØ§Ù‹ Ø¥Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ codes.json
  const checkRes = await fetch("/.netlify/functions/checkCode?action=check&code=" + data.code);
  const checkData = await checkRes.json();

  if (checkData.status === "allowed") {
    localStorage.setItem("access_code", "granted");
    window.location.href = "main.html"; // Ù…Ø¨Ø§Ø´Ø±Ø© ÙŠØ¯Ø®Ù„ main.html
  }
}

// Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
loadCode();
</script>

</body>
</html>
