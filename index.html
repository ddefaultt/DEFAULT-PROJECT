<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ø¯Ø®ÙˆÙ„</title>
</head>
<body>

<h1>ğŸ” ÙƒÙˆØ¯ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ</h1>
<div id="code" style="font-size:30px;font-weight:bold;margin-bottom:10px;"></div>
<p>Ø£Ø±Ø³Ù„ Ù‡Ø°Ø§ Ø§Ù„ÙƒÙˆØ¯ Ù„ØµØ§Ø­Ø¨ Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ù„ØªÙØ¹ÙŠÙ„Ù‡.</p>

<button onclick="checkAccess()">Ø¯Ø®ÙˆÙ„ Ù„Ù„Ù…ÙˆÙ‚Ø¹</button>

<script>
async function loadCode() {
  // Ø¬Ù„Ø¨ Ø§Ù„ÙƒÙˆØ¯ Ù…Ù† Ø§Ù„Ù€ Netlify Function
  const res = await fetch("/.netlify/functions/checkCode?action=get");
  const data = await res.json();

  // Ø¹Ø±Ø¶ Ø§Ù„ÙƒÙˆØ¯ Ù„Ù„Ù…Ø³ØªØ®Ø¯Ù…
  const codeDiv = document.getElementById("code");
  codeDiv.innerText = data.code;

  // ØªØ®Ø²ÙŠÙ† Ø§Ù„ÙƒÙˆØ¯ ÙÙŠ LocalStorage
  localStorage.setItem("my_code", data.code);
}

// Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯ Ø§Ù„Ù…ÙØ¹Ù‘Ù„
async function checkAccess() {
  const c = localStorage.getItem("my_code");
  const res = await fetch("/.netlify/functions/checkCode?action=check&code=" + c);
  const data = await res.json();

  if (data.status === "allowed") {
    localStorage.setItem("access_code", "granted");
    window.location.href = "main.html";
  } else {
    alert("âŒ Ø§Ù„ÙƒÙˆØ¯ ØºÙŠØ± Ù…ÙØ¹Ù„ Ø¨Ø¹Ø¯");
  }
}

// ØªØ­Ù…ÙŠÙ„ Ø§Ù„ÙƒÙˆØ¯ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
loadCode();
</script>

</body>
</html>
