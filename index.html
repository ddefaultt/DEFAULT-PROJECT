<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ุงูุชุญูู</title>
</head>
<body>

<h1>๐ ููุฏ ุงูุฏุฎูู ุงูุฎุงุต ุจู</h1>
<div id="code" style="font-size:28px; font-weight:bold;"></div>
<p>ุฃุฑุณู ูุฐุง ุงูููุฏ ูุตุงุญุจ ุงููููุน ูุชูุนููู.</p>
<p id="status" style="color:red; font-weight:bold;"></p>

<script>
// ุฌูุจ ุงูููุฏ ูู LocalStorage ุฅุฐุง ููุฌูุฏ
let tempCode = localStorage.getItem("temp_code");
let accessCode = localStorage.getItem("access_code");

if(accessCode){
    // ุฅุฐุง ุนูุฏู access_code ุจุงููุนู โ ูุฏุฎู ูุจุงุดุฑุฉ
    window.location.href = "main.html";
}

// ุฅุฐุง ูุงูุงูุด ููุฌูุฏ โ ููููุฏ ููุฏ ุฌุฏูุฏ
if(!tempCode) {
    tempCode = Math.floor(100000 + Math.random() * 900000).toString();
    localStorage.setItem("temp_code", tempCode);
}

// ุนุฑุถ ุงูููุฏ
document.getElementById("code").innerText = tempCode;

// ุฒุฑ ุชุญูู (ุชุณุชุฎุฏูู ุจุนุฏ ูุง ุชุถูู ุงูููุฏ ูู JSONbin)
function checkCode(){
    fetch(`/.netlify/functions/checkCode?code=${tempCode}`)
    .then(res => res.json())
    .then(data => {
        if(data.valid){
            localStorage.setItem("access_code", tempCode);
            window.location.href = "main.html";
        } else {
            document.getElementById("status").innerText = "โ ุงูููุฏ ุบูุฑ ููุนู ุฃู ุบูุฑ ููุฌูุฏ ูู whitelist";
        }
    })
    .catch(err => {
        document.getElementById("status").innerText = "โ ุฎุทุฃ ูู ุงูุงุชุตุงู ุจุงูุชุญูู";
    });
}

// ุชุญูู ุชููุงุฆู ุจุนุฏ Refresh
checkCode();
</script>

</body>
</html>
